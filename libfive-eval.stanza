defpackage libfive-eval :
   import core
   import math
   import collections
   import reader
   import geom
   import eval
   import shape
   import libfive
   import glu
   import font
   import eval-libfive-repl

public defn shape-eval (e) :
  match(e) :
    (g:Geom) : jit(g)
    (o) :      Msg(to-string(o))

public defn eval-libfive (s:String, libfive-env:Frame) -> Geom :
  val forms = read-all(s)
  ;; println-all(["FORMS: " forms])
  val es = unwrap-all(parse(forms))
  ;; println-all(["EXP: "   es])
  val e  = eval-begin(List(libfive-env), es)
  ;; println-all(["G: " e])
  shape-eval(e)
