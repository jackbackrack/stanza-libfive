defpackage geode-eval :
   import core
   import math
   import collections
   import reader
   import geom
   import eval
   import geode
   import glu
   import font
   import eval-geode-repl

public defn shape-eval (e) :
  match(e) :
    (g:Geom) : g
    (o) :      Msg(to-string(o))

public defn eval-geode (s:String, geode-env:Frame) -> Geom :
  val forms = read-all(s)
  ;; println-all(["FORMS: " forms])
  val es = unwrap-all(parse(forms))
  ;; println-all(["EXP: "   es])
  val e  = eval-begin(List(geode-env), es)
  ;; println-all(["G: " e])
  shape-eval(e)
